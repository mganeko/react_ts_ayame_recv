(this.webpackJsonpreact_ts_ayame_recv=this.webpackJsonpreact_ts_ayame_recv||[]).push([[0],{18:function(e,n,t){},31:function(e,n,t){},32:function(e,n,t){"use strict";t.r(n);var o=t(0),c=t(3),a=t.n(c),i=t(5),s=t(7),l=t(8),r=t(2),d=t(11),u=t(10),h=t(1),m=t.n(h),g=t(9),v=t.n(g);t(18);var b=function(e){var n=Object(h.useRef)(null);return Object(h.useEffect)((function(){var t=e.stream,o=0;e.volume&&(o=e.volume);var c=n.current;null!=c?(c.srcObject===t?console.log("useEffect() same stream, so skip:",t):(c.srcObject=t,console.log("useEffect() set stream:",t)),c.volume=o):console.log("useEffect() ref.current NULL")})),console.log("Video rendering, id=%s",e.id),e.controls?Object(o.jsx)("video",{className:"video_with_border",ref:n,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0,controls:!0}):Object(o.jsx)("video",{className:"video_with_border",ref:n,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0})},f=t(6),p=t(34),j=(t(31),""),y=function(){var e=window.location.search,n=new RegExp("key=([^&=]+)").exec(e),t=null;n&&(t=n[1]);return t}();y&&""!==y&&(j=y);var O="mm-react-ayame-test",x=function(){var e=window.location.search,n=new RegExp("room=([^&=]+)").exec(e),t="";n&&(t=n[1]);return t}();x&&""!==x&&(O=x);var w=Object(p.a)(),S=f.defaultOptions;console.log("Ayame default options:",S),S.clientId=w||S.clientId,j&&(S.signalingKey=j);var R=function(e){Object(d.a)(t,e);var n=Object(u.a)(t);function t(e){var o;return Object(s.a)(this,t),(o=n.call(this,e)).localStream=void 0,o.remoteStream=void 0,o.conn=void 0,o.state=void 0,o.localStream=null,o.state={playing:!1,connected:!1,gotRemoteStream:!1,roomId:O,signalingKey:j,videoCodec:"H264"},o.connect=o.connect.bind(Object(r.a)(o)),o.disconnect=o.disconnect.bind(Object(r.a)(o)),o.handleRoomChange=o.handleRoomChange.bind(Object(r.a)(o)),o.handleKeyChange=o.handleKeyChange.bind(Object(r.a)(o)),o.conn=null,o.remoteStream=null,o}return Object(l.a)(t,[{key:"componentDidMount",value:function(){console.log("App DidMound()")}},{key:"componentWillUnmount",value:function(){console.log("App WillUnmount()")}},{key:"connect",value:function(e){var n=this;e.preventDefault(),console.log("connect"),this.conn?console.warn("ALREADY connected"):(this.state.signalingKey&&""!==this.state.signalingKey&&(S.signalingKey=this.state.signalingKey),console.log("connecting roomId=%s key=%s",this.state.roomId,S.signalingKey),console.log("Ayame connect options:",S),this.conn=Object(f.connection)("wss://ayame-labo.shiguredo.jp/signaling",this.state.roomId,S),this.conn.on("open",(function(e){return console.log("auth:",e.authzMetadata)})),this.conn.on("disconnect",(function(e){console.log("disconnected:",e),n.handleDisconnect()})),this.conn.on("addstream",function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t.stream),n.remoteStream=t.stream,n.setState({gotRemoteStream:!0});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),this.conn.on("removestream",function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("removestream:",t),n.remoteStream=null,n.setState({gotRemoteStream:!1});case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),this.conn.connect(this.localStream).then((function(){console.log("connected"),n.setState({connected:!0})})).catch((function(e){console.error("connect ERROR:",e)})))}},{key:"disconnect",value:function(e){e.preventDefault(),console.log("disconnect"),this.handleDisconnect()}},{key:"handleDisconnect",value:function(){this.conn&&(this.conn.disconnect(),this.conn=null),this.remoteStream=null,this.setState({connected:!1,gotRemoteStream:!1})}},{key:"handleRoomChange",value:function(e){this.setState({roomId:e.target.value})}},{key:"handleKeyChange",value:function(e){this.setState({signalingKey:e.target.value})}},{key:"render",value:function(){return console.log("App render()"),Object(o.jsxs)("div",{className:"App",children:["React-TS Ayame-Labo RecvOnly",Object(o.jsx)("br",{}),"SignalingKey: ",Object(o.jsx)("input",{id:"signaling_key",type:"text",value:this.state.signalingKey,onChange:this.handleKeyChange,disabled:this.state.connected}),Object(o.jsx)("br",{}),"Room: ",Object(o.jsx)("input",{id:"room_id",type:"text",value:this.state.roomId,onChange:this.handleRoomChange,disabled:this.state.connected}),Object(o.jsx)("button",{onClick:this.connect,disabled:this.state.connected,children:" Connect"}),Object(o.jsx)("button",{onClick:this.disconnect,disabled:!this.state.connected,children:"Disconnect"}),Object(o.jsx)("div",{className:"VideoContainer",children:Object(o.jsx)("div",{className:"RemoteContainer",children:Object(o.jsx)(b,{id:"remote_video",width:"320px",height:"240px",volume:.5,controls:!0,stream:this.remoteStream})})})]})}}]),t}(m.a.Component);v.a.render(Object(o.jsx)(R,{}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.73442a9c.chunk.js.map